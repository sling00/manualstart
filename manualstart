#!/bin/bash
#Manualstart V1.0
#For PiMP by sling00 
#For issues please post them to: https://github.com/sling00/manualstart

#Global Variables
#Regular Expressions:
PATHREGEX='/\w+/\w+(\-|\_||)\w+'
MINERREGEX='\w+$'
#conf paths, default & user must end in / or the script will fail.
DEFAULTCONFPATH="/opt/pimp/defaultconfs/"
USERCONFPATH="/opt/ifmi/"
#Config file names.
MINERCONF_1="cgminer.scrypt.conf"
MINERCONF_2="cgminer.scryptn.conf"
MINERCONF_3="cgminer.keccak.conf"
MINERCONF_4="cgminer.qubit.conf"
MINERCONF_5="cgminer.jane.conf"
MINERCONF_6="cgminer.groestl.conf"
MINERCONF_7="cgminer.heavy.conf"
MINERCONF_8="cgminer.darkcoin.conf"
MINERCONF_9="cgminer.chacha.conf" #Not yet implemented.
#Miner paths
MINERD1="/opt/sgminer/sgminer"
MINERD2="/opt/sph-sgminer/sgminer"
MINERD3="/opt/cgminer_heavy/cgminer"
MINERD4="/opt/cgminer-3.7.2/cgminer"
MINERD5="/opt/sgminer-scryptjane/sgminer"
MINERD6="/opt/yacminer/yacminer"
#Algo menu names

MINER_1="Scrypt"
MINER_2="Scrypt-N (VERT)"
MINER_3="SHA3-Keccak (Maxcoin)"
MINER_4="Qubit"
MINER_5="Scrypt-Jane"
MINER_6="Groestl"
MINER_7="Heavy (Experimental)"
MINER_8="X11 (Darkcoin)"
MINER_9="Scrypt Chacha (Not yet implemented)"
QUIT_NAME="Quit"
#Unused testing code:
#PATHREGEX="\/?[a-z][a-z0-9_]*\/[a-z][a-z0-9-_]*"
#echo options $OPTIONS
#MINERPATH=$(echo $MINERD_1 | grep -P '\/?[a-z][a-z0-9_]*\/[a-z][a-z0-9-_]*' ) #| echo "$MINERPATH")
#MINERPATH=$(echo $MINERD1 | grep -oP '\/?[a-z][a-z0-9_]*\/[a-z][a-z0-9-_]*' ) #| echo "$MINERPATH")
#MINERPATH=$(echo $MINERD | grep -oP '/\w+/\w+(\-|\_||)\w+' )
#local MINERPATH=$(echo $MINERD | grep -oP $PATHREGEX )
#echo $MINERPATH
#echo "$MINER_2 $MINER_3 $MINER_4 $MINER_5 $MINER_6 $MINER_7 $MINER_8 $MINER_9'
           #    if [ "$opt" = "$MINER_10" ]; then
            #    echo "Exiting...."
             #   exit
             #  elif [ "$opt" = "$MINER_2" ]; then
             #  echo Hello World
             #  elif [ "$opt" = "$MINER_3" ]; then
             #   echo "scrypt"
             #  else
             #   clear
             #   echo bad option
             #  fi
           #done
#end unused code.

#test variables. remove before final release

ALGO=x11
#end test variables
function f.defaultconf() {
 CONFDIR="/opt/pimp/defaultconfs/cgminer.$ALGO.conf"
}
function f.minerexec {
 MINEREXEC=$(echo $MINERD | grep -oP $MINERREGEX ) 
}
function f.minerpath() {
MINERPATH=$(echo $MINERD | grep -oP $PATHREGEX )
	}
function f.minerconf() {
MINERCONF="cgminer.$ALGO.conf"
}
function f.mineroptions(){
MINEROPTIONS = "--"
}
function startminer.1(){
	f.minerexec
	#f.minerconf
	MINERCONF="/opt/ifmi/cgminer.conf"
	echo "Starting $MINER_1 mining with miner \" $MINEREXEC \" in $MINERPATH"
	echo "cd $MINERPATH"
	echo "./${MINEREXEC} -c $MINERCONF $MINEROPTIONS"
	 } 
function manualmenu() {
#$THELINE


OPTIONS="\"$MINER_1\" \"$MINER_2\" \"$MINER_3\" \"$MINER_4\" \"$MINER_5\" \"$MINER_6\" \"$MINER_7\" \"$MINER_8\" \"$MINER_9\" \"$QUIT_NAME\""

echo 'Miners available: '
eval set $OPTIONS
PS3="Select a miner:"
           select opt in "$@"; do
               case "$opt" in
               	$MINER_1 )
				MINERD="$MINERD1"
				f.minerpath
				startminer.1
	#			echo "Starting $MINER_1 with $MINERPATH"
				;;

				$QUIT_NAME )
				echo "Exiting..."
				exit 0
				;;
				* )
			#	echo "$@"
				clear
				echo "bad option, try again"
				#Recall the menu so it will show the options again
				manualmenu
				;;
			esac
		done
}
#Actual work begins below....
#Call the menu
manualmenu
